{"version":3,"file":"block-board-layout-editor.js","sourceRoot":"","sources":["../src/block-board-layout-editor.ts"],"names":[],"mappings":";AAAA,OAAO,EACL,UAAU,EACV,IAAI,EACJ,QAAQ,GAGT,MAAM,aAAa,CAAC;AACrB,OAAO,EAAE,kBAAkB,EAAE,MAAM,oDAAoD,CAAC;AAGxF,OAAO,EAAE,YAAY,EAAE,MAAM,gBAAgB,CAAC;AAC9C,OAAO,EAAE,mBAAmB,IAAI,MAAM,EAAE,MAAM,0BAA0B,CAAC;AACzE,OAAO,EAAE,UAAU,EAAE,MAAM,4CAA4C,CAAC;AACxE,OAAO,EAAE,cAAc,EAAE,MAAM,oBAAoB,CAAC;AAEpD,MAAM,OAAO,sBAAuB,SAAS,MAAM,CACjD,UAAU,CACiB;IAF7B;;QAKqC,oBAAe,GAAiB,EAAE,CAAC;IAyLxE,CAAC;IArLC,iBAAiB;QACf,KAAK,CAAC,iBAAiB,EAAE,CAAC;QAC1B,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,kBAAkB,CAAC;IAC9C,CAAC;IAED,qBAAqB;QACnB,OAAO,IAAI,CAAC,YAAY,CAAC;IAC3B,CAAC;IAED,MAAM,KAAK,cAAc;QACvB,OAAO;YACL,kBAAkB,EAAE,cAAc;YAClC,qBAAqB,EAAE,kBAAkB;YACzC,iBAAiB,EAAE,UAAU;SAC9B,CAAC;IACJ,CAAC;IAED,eAAe,CACb,SAA6B,EAC7B,MAGC,EACD,WAGC;QAED,OAAO,IAAI,CAAA;;;;qBAIM,GAAG,EAAE;YACZ,IAAI,MAAM,EAAE;gBACV,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,SAAS,CAAC,GAAG;oBACpC,SAAS,EAAE,UAAU;oBACrB,qBAAqB,EAAE,GAAG;oBAC1B,KAAK,EAAE,CAAC,SAAS,EAAE,SAAS,CAAC;iBAC9B,CAAC;aACH;iBAAM;gBACL,IAAI,CAAC,YAAY,GAAG;oBAClB,SAAS,EAAE,UAAU;oBACrB,qBAAqB,EAAE,GAAG;oBAC1B,KAAK,EAAE,CAAC,SAAS,EAAE,SAAS,CAAC;iBAC9B,CAAC;aACH;YACD,IAAI,CAAC,YAAY,EAAE,CAAC;QACtB,CAAC;;;;qBAIQ,GAAG,EAAE;YACZ,IAAI,MAAM,EAAE;gBACV,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,SAAS,CAAC,GAAG;oBACpC,SAAS,EAAE,YAAY;oBACvB,qBAAqB,EAAE,GAAG;oBAC1B,KAAK,EAAE,CAAC,SAAS,EAAE,SAAS,CAAC;iBAC9B,CAAC;aACH;iBAAM;gBACL,IAAI,CAAC,YAAY,GAAG;oBAClB,SAAS,EAAE,YAAY;oBACvB,qBAAqB,EAAE,GAAG;oBAC1B,KAAK,EAAE,CAAC,SAAS,EAAE,SAAS,CAAC;iBAC9B,CAAC;aACH;YAED,IAAI,CAAC,YAAY,EAAE,CAAC;QACtB,CAAC;;;;wBAIW,CAAC,MAAM;qBACV,GAAG,EAAE;YACZ,IAAI,MAAM,EAAE;gBACV,MAAM,UAAU,GAAG,MAAM,CAAC,SAAS,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gBAClD,MAAM,SAAS,GAAG,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;gBAEhD,IAAI,WAAW,EAAE;oBACf,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,SAAS,CAAC,GAAG,SAAS,CAAC;iBAC3D;qBAAM;oBACL,IAAI,CAAC,YAAY,GAAG,SAAS,CAAC;iBAC/B;aACF;YAED,IAAI,CAAC,YAAY,EAAE,CAAC;QACtB,CAAC;;;;;;kBAMK,CAAC,CAAY,EAAE,EAAE;;YACvB,MAAM,SAAS,SAAG,CAAC,CAAC,YAAY,0CAAE,OAAO,CAAC,WAAW,CAAC,CAAC;YAEvD,IAAI,MAAM,EAAE;gBACV,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,SAAS,CAAC,GAAG,SAAS,CAAC;aACjD;iBAAM;gBACL,IAAI,CAAC,YAAY,GAAG,SAAS,CAAC;aAC/B;YACD,IAAI,CAAC,YAAY,EAAE,CAAC;QACtB,CAAC;sBACW,CAAC,CAAY,EAAE,EAAE,CAAC,CAAC,CAAC,cAAc,EAAE;;YAE9C,SAAS,IAAI,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC;YACtC,CAAC,CAAC,IAAI,CAAA;;yBAEO,IAAI,CAAC,SAAS,CAAC,SAAS,CAAU;mCACxB;YACvB,CAAC,CAAC,IAAI,CAAA,EAAE;;;KAGf,CAAC;IACJ,CAAC;IAED,YAAY;QACV,IAAI,CAAC,aAAa,CAChB,IAAI,WAAW,CAAC,gBAAgB,EAAE;YAChC,OAAO,EAAE,IAAI;YACb,QAAQ,EAAE,IAAI;SACf,CAAC,CACH,CAAC;QACF,IAAI,CAAC,aAAa,EAAE,CAAC;IACvB,CAAC;IAED,SAAS,CAAC,SAAiB;QACzB,OAAO,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,IAAI,KAAK,SAAS,CAAC,CAAC;IAChE,CAAC;IAED,gBAAgB,CACd,WAAwB,EACxB,UAGC;QAED,OAAO,IAAI,CAAA;;uBAEQ,WAAW,CAAC,SAAS;;4BAEhB,CAAC,CAAM,EAAE,EAAE;YAC7B,MAAM,SAAS,GAAG,CAAC,WAAgB,EAAE,EAAE,CACrC,QAAQ,CACN,WAAW;iBACR,aAAa,EAAE,CAAC,CAAC,CAAC;iBAClB,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;iBACxB,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAClB,CAAC;YACJ,MAAM,aAAa,GAAG,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC;YACrD,MAAM,eAAe,GAAG,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC;YAEzD,WAAW,CAAC,qBAAqB;gBAC/B,aAAa,GAAG,CAAC,aAAa,GAAG,eAAe,CAAC,CAAC;QACtD,CAAC;;UAEC,WAAW,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,IAAI,EAAE,KAAK,EAAE,EAAE;YACtC,IAAI,CAAC,IAAI,IAAI,OAAO,IAAI,KAAK,QAAQ;gBACnC,OAAO,IAAI,CAAC,eAAe,CACzB,IAAI,EACJ,EAAE,IAAI,EAAE,WAAW,EAAE,SAAS,EAAE,KAAK,EAAE,EACvC,UAAU,CACX,CAAC;;gBAEF,OAAO,IAAI,CAAC,gBAAgB,CAAC,IAAI,EAAE;oBACjC,IAAI,EAAE,WAAW;oBACjB,SAAS,EAAE,KAAK;iBACjB,CAAC,CAAC;QACP,CAAC,CAAC;;KAEL,CAAC;IACJ,CAAC;IAED,MAAM;QACJ,IAAI,CAAC,IAAI,CAAC,YAAY,IAAI,OAAO,IAAI,CAAC,YAAY,KAAK,QAAQ;YAC7D,OAAO,IAAI,CAAC,eAAe,CACzB,IAAI,CAAC,YAAkC,EACvC,SAAS,EACT,SAAS,CACV,CAAC;;YAEF,OAAO,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,YAA2B,EAAE,SAAS,CAAC,CAAC;IAC9E,CAAC;;AA1LM,6BAAM,GAAG,YAAY,CAAC;AAEF;IAA1B,QAAQ,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,CAAC;+DAA4C;AAC1C;IAA3B,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;kEAAuC;AACtC;IAA3B,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;4DAAoC","sourcesContent":["import {\n  LitElement,\n  html,\n  property,\n  TemplateResult,\n  Constructor,\n} from \"lit-element\";\nimport { SplitLayoutElement } from \"@vaadin/vaadin-split-layout/vaadin-split-layout.js\";\n\nimport { Block, BlockLayout, BlockNode } from \"./types\";\nimport { sharedStyles } from \"./sharedStyles\";\nimport { ScopedElementsMixin as Scoped } from \"@open-wc/scoped-elements\";\nimport { IconButton } from \"scoped-material-components/mwc-icon-button\";\nimport { BlockBoardSlot } from \"./block-board-slot\";\n\nexport class BlockBoardLayoutEditor extends (Scoped(\n  LitElement\n) as Constructor<LitElement>) {\n  static styles = sharedStyles;\n\n  @property({ type: Array }) private availableBlocks: Array<Block> = [];\n  @property({ type: Object }) public initialBlockLayout!: BlockNode;\n  @property({ type: Object }) protected _blockLayout!: BlockNode;\n\n  connectedCallback() {\n    super.connectedCallback();\n    this._blockLayout = this.initialBlockLayout;\n  }\n\n  getEditingBlockLayout() {\n    return this._blockLayout;\n  }\n\n  static get scopedElements() {\n    return {\n      \"block-board-slot\": BlockBoardSlot,\n      \"vaadin-split-layout\": SplitLayoutElement,\n      \"mwc-icon-button\": IconButton,\n    };\n  }\n\n  renderBlockNode(\n    blockName: string | undefined,\n    parent?: {\n      node: BlockLayout;\n      slotIndex: number;\n    },\n    grandparent?: {\n      node: BlockLayout;\n      slotIndex: number;\n    }\n  ) {\n    return html`\n      <div class=\"column\" style=\"flex: 1;\">\n        <div class=\"row\" style=\"justify-content: flex-end;\">\n          <mwc-icon-button\n            @click=${() => {\n              if (parent) {\n                parent.node.slots[parent.slotIndex] = {\n                  direction: \"vertical\",\n                  firstSlotRelativeSize: 0.5,\n                  slots: [blockName, undefined],\n                };\n              } else {\n                this._blockLayout = {\n                  direction: \"vertical\",\n                  firstSlotRelativeSize: 0.5,\n                  slots: [blockName, undefined],\n                };\n              }\n              this.updateLayout();\n            }}\n            icon=\"horizontal_split\"\n          ></mwc-icon-button>\n          <mwc-icon-button\n            @click=${() => {\n              if (parent) {\n                parent.node.slots[parent.slotIndex] = {\n                  direction: \"horizontal\",\n                  firstSlotRelativeSize: 0.5,\n                  slots: [blockName, undefined],\n                };\n              } else {\n                this._blockLayout = {\n                  direction: \"horizontal\",\n                  firstSlotRelativeSize: 0.5,\n                  slots: [blockName, undefined],\n                };\n              }\n\n              this.updateLayout();\n            }}\n            icon=\"vertical_split\"\n          ></mwc-icon-button>\n          <mwc-icon-button\n            .disabled=${!parent}\n            @click=${() => {\n              if (parent) {\n                const otherIndex = parent.slotIndex === 0 ? 1 : 0;\n                const blockName = parent.node.slots[otherIndex];\n\n                if (grandparent) {\n                  grandparent.node.slots[grandparent.slotIndex] = blockName;\n                } else {\n                  this._blockLayout = blockName;\n                }\n              }\n\n              this.updateLayout();\n            }}\n            icon=\"delete\"\n          ></mwc-icon-button>\n        </div>\n        <div\n          style=\"background-color: rgba(0, 0, 0, 0.1); flex: 1;\"\n          @drop=${(e: DragEvent) => {\n            const blockName = e.dataTransfer?.getData(\"blockName\");\n\n            if (parent) {\n              parent.node.slots[parent.slotIndex] = blockName;\n            } else {\n              this._blockLayout = blockName;\n            }\n            this.updateLayout();\n          }}\n          @dragover=${(e: DragEvent) => e.preventDefault()}\n        >\n          ${blockName && this.findBlock(blockName)\n            ? html`<block-board-slot\n                style=\"pointer-events: none;\"\n                .block=${this.findBlock(blockName) as Block}\n              ></block-board-slot>`\n            : html``}\n        </div>\n      </div>\n    `;\n  }\n\n  updateLayout() {\n    this.dispatchEvent(\n      new CustomEvent(\"layout-updated\", {\n        bubbles: true,\n        composed: true,\n      })\n    );\n    this.requestUpdate();\n  }\n\n  findBlock(blockName: string): Block | undefined {\n    return this.availableBlocks.find((b) => b.name === blockName);\n  }\n\n  renderLayoutNode(\n    blockLayout: BlockLayout,\n    parentNode?: {\n      node: BlockLayout;\n      slotIndex: number;\n    }\n  ): TemplateResult {\n    return html`\n      <vaadin-split-layout\n        .orientation=${blockLayout.direction}\n        style=\"flex: 1;\"\n        @splitter-dragend=${(e: any) => {\n          const getPxSize = (slotElement: any) =>\n            parseInt(\n              slotElement\n                .assignedNodes()[0]\n                .style.flex.split(\" \")[2]\n                .split(\"px\")[0]\n            );\n          const primaryPxSize = getPxSize(e.path[0].$.primary);\n          const secondaryPxSize = getPxSize(e.path[0].$.secondary);\n\n          blockLayout.firstSlotRelativeSize =\n            primaryPxSize / (primaryPxSize + secondaryPxSize);\n        }}\n      >\n        ${blockLayout.slots.map((slot, index) => {\n          if (!slot || typeof slot === \"string\")\n            return this.renderBlockNode(\n              slot,\n              { node: blockLayout, slotIndex: index },\n              parentNode\n            );\n          else\n            return this.renderLayoutNode(slot, {\n              node: blockLayout,\n              slotIndex: index,\n            });\n        })}\n      </vaadin-split-layout>\n    `;\n  }\n\n  render() {\n    if (!this._blockLayout || typeof this._blockLayout === \"string\")\n      return this.renderBlockNode(\n        this._blockLayout as string | undefined,\n        undefined,\n        undefined\n      );\n    else\n      return this.renderLayoutNode(this._blockLayout as BlockLayout, undefined);\n  }\n}\n"]}