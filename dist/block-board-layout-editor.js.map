{"version":3,"file":"block-board-layout-editor.js","sourceRoot":"","sources":["../src/block-board-layout-editor.ts"],"names":[],"mappings":"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","sourcesContent":["import { LitElement, html, property, TemplateResult } from \"lit-element\";\nimport { SplitLayoutElement } from \"@vaadin/vaadin-split-layout/vaadin-split-layout.js\";\n\nimport { Block, BlockLayoutNode } from \"./block\";\nimport { sharedStyles } from \"./sharedStyles\";\nimport { Scoped } from \"scoped-elements\";\nimport { IconButton } from \"scoped-material-components/dist/mwc-icon-button\";\nimport { CircularProgress } from \"scoped-material-components/dist/mwc-circular-progress\";\nimport { BlockBoardSlot } from \"./block-board-slot\";\n\nexport class BlockBoardLayoutEditor extends Scoped(LitElement) {\n  static styles = sharedStyles;\n\n  @property({ type: Array }) private availableBlocks: Array<Block> = [];\n  @property({ type: Object }) blockLayout!: BlockLayoutNode;\n\n  static get scopedElements() {\n    return {\n      \"block-board-slot\": BlockBoardSlot,\n      \"vaadin-split-layout\": SplitLayoutElement,\n      \"mwc-icon-button\": IconButton,\n      \"mwc-circular-progress\": CircularProgress,\n    };\n  }\n\n  firstUpdated() {\n    if (this.blockLayout === undefined) {\n      this.blockLayout = {\n        direction: \"horizontal\",\n        slots: [undefined, undefined],\n        firstSlotRelativeSize: 0.5,\n      };\n    }\n  }\n\n  renderBlockSlot(\n    blockName: string | undefined,\n    parentNode: BlockLayoutNode,\n    slotIndex: number\n  ) {\n    return html`\n      <div class=\"column\">\n        <div class=\"row\" style=\"justify-content: flex-end;\">\n          <mwc-icon-button\n            @click=${() => {\n              parentNode.slots[slotIndex] = {\n                direction: \"vertical\",\n                firstSlotRelativeSize: 0.5,\n                slots: [blockName, undefined],\n              };\n              this.requestUpdate();\n            }}\n            icon=\"horizontal_split\"\n          ></mwc-icon-button>\n          <mwc-icon-button\n            @click=${() => {\n              parentNode.slots[slotIndex] = {\n                direction: \"horizontal\",\n                firstSlotRelativeSize: 0.5,\n                slots: [blockName, undefined],\n              };\n              this.requestUpdate();\n            }}\n            icon=\"vertical_split\"\n          ></mwc-icon-button>\n          <mwc-icon-button\n            @click=${() => {\n              parentNode.slots.splice(slotIndex, 1)\n              this.requestUpdate();\n            }}\n            icon=\"delete\"\n          ></mwc-icon-button>\n        </div>\n        <div\n          style=\"background-color: gray; flex: 1;\"\n          @drop=${(e: DragEvent) => {\n            const blockName = e.dataTransfer?.getData(\"blockName\");\n\n            parentNode.slots[slotIndex] = blockName;\n            this.requestUpdate();\n          }}\n          @dragover=${(e: DragEvent) => e.preventDefault()}\n        >\n          ${blockName !== undefined && this.findBlock(blockName)\n            ? html`<block-board-slot\n                style=\"pointer-events: none;\"\n                .block=${this.findBlock(blockName) as Block}\n              ></block-board-slot>`\n            : html``}\n        </div>\n      </div>\n    `;\n  }\n\n  findBlock(blockName: string): Block | undefined {\n    return this.availableBlocks.find((b) => b.name === blockName);\n  }\n\n  renderLayoutNode(blockLayout: BlockLayoutNode): TemplateResult {\n    return html`\n      <vaadin-split-layout\n        .orientation=${blockLayout.direction}\n        style=\"flex: 1;\"\n        @splitter-dragend=${(e: any) => {\n          const getPxSize = (slotElement: any) =>\n            parseInt(\n              slotElement\n                .assignedNodes()[0]\n                .style.flex.split(\" \")[2]\n                .split(\"px\")[0]\n            );\n          const primaryPxSize = getPxSize(e.path[0].$.primary);\n          const secondaryPxSize = getPxSize(e.path[0].$.secondary);\n\n          blockLayout.firstSlotRelativeSize =\n            primaryPxSize / (primaryPxSize + secondaryPxSize);\n        }}\n      >\n        ${blockLayout.slots.map((slot, index) => {\n          if (slot === undefined || typeof slot === \"string\")\n            return this.renderBlockSlot(slot, blockLayout, index);\n          else return this.renderLayoutNode(slot);\n        })}\n      </vaadin-split-layout>\n    `;\n  }\n\n  render() {\n    if (!this.blockLayout)\n      return html`<mwc-circular-progress></mwc-circular-progress>`;\n    return this.renderLayoutNode(this.blockLayout);\n  }\n}\n"]}